<!DOCTYPE html>
<html>

<head>
    <title>Kea Water 001</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="data:,">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="chart.min.js"></script>
</head>

<body>
    <div style="text-align:center;">Water Quality Data</div>
    <div class="chart-container" position: relative; height:350px; width:100%">
        <canvas id="Chart" width="400" height="400"></canvas>
    </div>

    <script>
        //Graphs visit: https://www.chartjs.org
        var data = [];
        var dataSeries = {}
        var timeStamp = [];
        function showGraph() {
            //  for (i = 0; i < arguments.length; i++) {
            //    values.push(arguments[i]);    
            //  }

            var ctx = document.getElementById("Chart").getContext('2d');
            var Chart2 = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data,  //Bottom Labeling
                    datasets: [{
                        label: "Ph",
                        fill: false,
                        backgroundColor: 'rgba( 18, 156, 243 , 1)', //Dot marker color
                        borderColor: 'rgba( 18, 156, 243 , 1)', //Graph Line Color
                        data: data,
                    }],
                },
                options: {
                    title: {
                        display: true,
                        text: "ADC Voltage"
                    },
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            tension: 0.2 //Smoothening (Curved) of data lines
                        }
                    }
                }
            });

        }

        //On Page load show graphs
        window.onload = function () {
            getData();
        };

        //Ajax script to get ADC voltage at every 5 Seconds 

        // setInterval(function() {
        //   // Call a function repetatively with 5 Second interval
        //   getData();
        // }, 5000); 

        function getData() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var lines = this.responseText.split("\n");
                    lines && lines.forEach((line, lineNumber) => {
                        var rowValues = line.split(",")
                        if (lineNumber == 0) { // header row
                            rowValues.forEach(value => {
                                dataSeries[value] = []
                            })
                        } else {
                            rowValues.forEach(value => {
                                data.push(value)
                            })
                        }
                    })

                    showGraph();
                }
            };
            xhttp.open("GET", "Water Quality Data.csv", true);
            xhttp.send();
        }

    </script>
</body>

</html>