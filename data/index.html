<!DOCTYPE html>
<html>

<head>
    <title>Kea Water 001</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="data:,">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="chart.min.js"></script>
</head>

<body>
    <div style="text-align:center;">Water Quality Data</div>
    <div class="chart-container" position: relative; height:350px; width:100%">
        <canvas id="ChartGPSLat" width="400" height="400"></canvas>
    </div>
    <div class="chart-container" position: relative; height:350px; width:100%">
        <canvas id="ChartGPSLong" width="400" height="400"></canvas>
    </div>


    <script>
        const numberOfDataSeries = 2
        var charts = {
            GPSLat: {
                canvasID: "ChartGPSLat",
                chartTitle: "GPS Lattitude",
                xAxisLabels: [],
                values: []
            },
            GPSLong: {
                canvasID: "ChartGPSLong",
                chartTitle: "GPS Longitude",
                xAxisLabels: [],
                values: []
            }
        }
        function showGraph({
            canvasID,
            chartTitle,
            xAxisLabels,
            values
        }) {
            new Chart(document.getElementById(canvasID).getContext('2d'), {
                type: 'line',
                data: {
                    labels: xAxisLabels,  //Bottom Labeling
                    datasets: [{
                        label: chartTitle,
                        fill: false,
                        backgroundColor: 'rgba( 18, 156, 243 , 1)', //Dot marker color
                        borderColor: 'rgba( 18, 156, 243 , 1)', //Graph Line Color
                        data: values
                    }],
                },
                options: {
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            tension: 0.2 //Smoothening (Curved) of data lines
                        }
                    }
                }
            });
        }

        window.onload = getData

        function getData() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {

                    var lines = this.responseText.split("\n");
                    lines && lines.forEach((line, lineNumber) => {
                        var rowValues = line.split(",")
                        if (rowValues.length == (numberOfDataSeries + 2)) { // skip incomplete lines
                            if (lineNumber == 0) { // ignore header row (other than console logging it)
                                console.log(rowValues)
                            } else {
                                rowValues = rowValues.map(val => val.replace('\r',''))
                                
                                charts.GPSLat.xAxisLabels.push(`${rowValues[0]} ${rowValues[1]}`)
                                charts.GPSLat.values.push(rowValues[2])

                                charts.GPSLong.xAxisLabels.push(`${rowValues[0]} ${rowValues[1]}`)
                                charts.GPSLong.values.push(rowValues[3])
                            }
                        }
                    })

                    showGraph(charts.GPSLat);
                    showGraph(charts.GPSLong);
                }
            };
            xhttp.open("GET", "Water Quality Data.csv", true);
            xhttp.send();
        }

    </script>
</body>

</html>